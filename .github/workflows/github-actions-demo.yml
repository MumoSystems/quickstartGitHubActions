name: GitHub Actions Demo
run-name: ${{ github.actor }} is testing out GitHub Actions ğŸš€
on:
  push:
  #pull_request:
    #types: [opened, closed, synchronize]
jobs:
  deploy:
    runs-on: ubuntu-latest
    environment: Testing
    steps:
      - name: Wait for merge if not merged
        id: wait_for_merge
        run: |
          if [[ "${{ github.event.pull_request.merged }}" != "true" ]]; then
            echo "Pull request not merged. Waiting 5 minutes before checking again..."
            sleep 300
            # Fetch PR status again using GitHub API
            pr_number=${{ github.event.pull_request.number }}
            repo=${{ github.repository }}
            merged=$(gh pr view $pr_number --repo $repo --json merged --jq .merged)
            if [[ "$merged" != "true" ]]; then
              echo "Pull request still not merged after waiting. Exiting."
              exit 1
            fi
          fi
      - name: Simulate deploy to production
        if: success()
        run: echo "ğŸš€ Simulating deployment to the production environment..."
      - run: echo "ğŸ This job's status is ${{ job.status }}."